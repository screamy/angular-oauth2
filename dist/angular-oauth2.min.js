!function(e,t){"function"==typeof define&&define.amd?define(["angular","query-string"],t):"object"==typeof exports?module.exports=t(require("angular"),require("query-string")):e.angularOAuth2=t(e.angular,e.queryString)}(this,function(e,t){function r(e){e.interceptors.push("oauthInterceptor")}function n(){var r;this.configure=function(t){if(r)throw new Error("Already configured.");if(!(t instanceof Object))throw new TypeError("Invalid argument: `config` must be an `Object`.");return r=e.extend({},u,t),e.forEach(c,function(e){if(!r[e])throw new Error("Missing parameter: "+e+".")}),"/"===r.baseUrl.substr(-1)&&(r.baseUrl=r.baseUrl.slice(0,-1)),"/"!==r.grantPath[0]&&(r.grantPath="/"+r.grantPath),"/"!==r.revokePath[0]&&(r.revokePath="/"+r.revokePath),r},this.$get=function(n,o){var i=function(){function i(){if(!r)throw new Error("`OAuthProvider` must be configured first.")}return a(i,null,{isAuthenticated:{value:function(){return!!o.getToken()},writable:!0,enumerable:!0,configurable:!0},getAccessToken:{value:function(i,a){if(!i||!i.username||!i.password)throw new Error("`user` must be an object with `username` and `password` properties.");var u={client_id:r.clientId,grant_type:"password",username:i.username,password:i.password};return null!==r.clientSecret&&(u.client_secret=r.clientSecret),u=t.stringify(u),a=e.extend({headers:{"Content-Type":"application/x-www-form-urlencoded"}},a),n.post(""+r.baseUrl+r.grantPath,u,a).then(function(e){return o.setToken(e.data),e})},writable:!0,enumerable:!0,configurable:!0},getRefreshToken:{value:function(){var e={client_id:r.clientId,grant_type:"refresh_token",refresh_token:o.getRefreshToken()};null!==r.clientSecret&&(e.client_secret=r.clientSecret),e=t.stringify(e);var i={headers:{"Content-Type":"application/x-www-form-urlencoded"}};return n.post(""+r.baseUrl+r.grantPath,e,i).then(function(e){return o.setToken(e.data),e})},writable:!0,enumerable:!0,configurable:!0},revokeToken:{value:function(){var e=t.stringify({token:o.getRefreshToken()?o.getRefreshToken():o.getAccessToken()}),i={headers:{"Content-Type":"application/x-www-form-urlencoded"}};return n.post(""+r.baseUrl+r.revokePath,e,i).then(function(e){return o.removeToken(),e})},writable:!0,enumerable:!0,configurable:!0}}),i}();return new i},this.$get.$inject=["$http","OAuthToken"]}function o(){var t={name:"token",storage:"cookies",options:{secure:!0}};this.configure=function(r){if(!(r instanceof Object))throw new TypeError("Invalid argument: `config` must be an `Object`.");return e.extend(t,r),t},this.$get=function(e){var r=e.get(t.storage+"Adapter"),n=function(){function e(){}return a(e,null,{setToken:{value:function(e){return r.putObject(t.name,e,t.options)},writable:!0,enumerable:!0,configurable:!0},getToken:{value:function(){return r.getObject(t.name)},writable:!0,enumerable:!0,configurable:!0},getAccessToken:{value:function(){return this.getToken()?this.getToken().access_token:void 0},writable:!0,enumerable:!0,configurable:!0},getAuthorizationHeader:{value:function(){return this.getTokenType()&&this.getAccessToken()?""+(this.getTokenType().charAt(0).toUpperCase()+this.getTokenType().substr(1))+" "+this.getAccessToken():void 0},writable:!0,enumerable:!0,configurable:!0},getRefreshToken:{value:function(){return this.getToken()?this.getToken().refresh_token:void 0},writable:!0,enumerable:!0,configurable:!0},getTokenType:{value:function(){return this.getToken()?this.getToken().token_type:void 0},writable:!0,enumerable:!0,configurable:!0},removeToken:{value:function(){return r.remove(t.name,t.options)},writable:!0,enumerable:!0,configurable:!0}}),e}();return new n},this.$get.$inject=["$injector"]}function i(e,t,r){return{request:function(e){return r.getAuthorizationHeader()&&(e.headers=e.headers||{},e.headers.Authorization=r.getAuthorizationHeader()),e},responseError:function(n){return 400!==n.status||!n.data||"invalid_request"!==n.data.error&&"invalid_grant"!==n.data.error||(r.removeToken(),t.$emit("oauth:error",n)),(401===n.status&&n.data&&"invalid_token"===n.data.error||n.headers("www-authenticate")&&0===n.headers("www-authenticate").indexOf("Bearer"))&&t.$emit("oauth:error",n),e.reject(n)}}}r.$inject=["$httpProvider"];var a=function(e,t,r){t&&Object.defineProperties(e,t),r&&Object.defineProperties(e.prototype,r)},u={baseUrl:null,clientId:null,clientSecret:null,grantPath:"/oauth2/token",revokePath:"/oauth2/revoke"},c=["baseUrl","clientId","grantPath","revokePath"],a=function(e,t,r){t&&Object.defineProperties(e,t),r&&Object.defineProperties(e.prototype,r)};i.$inject=["$q","$rootScope","OAuthToken"];var a=function(e,t,r){t&&Object.defineProperties(e,t),r&&Object.defineProperties(e.prototype,r)},s=function(){function e(e){this.JSON=e.JSON,this.localStorage=e.localStorage}return e.$inject=["$window"],a(e,null,{putObject:{value:function(e,t){return this.localStorage.setItem(e,this.JSON.stringify(t))},writable:!0,enumerable:!0,configurable:!0},getObject:{value:function(e){return this.JSON.parse(this.localStorage.getItem(e))},writable:!0,enumerable:!0,configurable:!0},remove:{value:function(e){return this.localStorage.removeItem(e)},writable:!0,enumerable:!0,configurable:!0}}),e}(),l=function(){function e(e){this.$cookies=e}return e.$inject=["$cookies"],a(e,null,{putObject:{value:function(e,t,r){return this.$cookies.putObject(e,t,r)},writable:!0,enumerable:!0,configurable:!0},getObject:{value:function(e){return this.$cookies.getObject(e)},writable:!0,enumerable:!0,configurable:!0},remove:{value:function(e,t){return this.$cookies.remove(e,t)},writable:!0,enumerable:!0,configurable:!0}}),e}(),f=e.module("angular-oauth2",[]).config(r).factory("oauthInterceptor",i).provider("OAuth",n).provider("OAuthToken",o).service("localstorageAdapter",s).service("cookiesAdapter",l);return f});